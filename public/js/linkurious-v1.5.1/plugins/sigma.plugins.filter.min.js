(function(undefined){"use strict";function deepCopy(o){var copy=Object.create(null);for(var i in o)"object"==typeof o[i]&&null!==o[i]?copy[i]=deepCopy(o[i]):"function"==typeof o[i]&&null!==o[i]?eval(" copy[i] = "+o[i].toString()):copy[i]=o[i];return copy}function cloneChain(a){for(var b=a.slice(0),c=0,d=b.length;d>c;c++)b[c]=deepCopy(b[c]);return b}function strToObjectRef(a,b){return b.split(".").reduce(function(a,b){return a[b]},a)}function Filter(s){function register(a,b,c,d){if(arguments[3]===undefined&&"object"!=typeof arguments[2]&&(d=c,c=null),d!==undefined&&"number"!=typeof d&&"string"!=typeof d)throw new TypeError('Invalid argument: "key" is not a number or a string, was '+d);if(d!==undefined&&"string"==typeof d&&!d.length)throw new TypeError('Invalid argument: "key" is an empty string.');if("string"!=typeof a)throw new TypeError('Invalid argument: "processor" is not a string, was '+a);if("undo"===d)throw new Error('Invalid argument: "key" has value "undo", which is a reserved keyword.');if(_keysIndex[d])throw new Error('Invalid argument: the filter of key "'+d+'" already exists.');d&&(_keysIndex[d]=!0),_chain.push({key:d,processor:a,predicate:b,options:c||{}})}function unregister(a){_chain=_chain.filter(function(b){return!(b.key in a)});for(var b in a)delete _keysIndex[b]}var _self=this,_s=s,_g=s.graph,_chain=[],_keysIndex=Object.create(null);this.has=function(a){return _keysIndex[a]},this.nodesBy=function(a,b,c){return register("nodes",a,b,c),this},this.edgesBy=function(a,b,c){return register("edges",a,b,c),this},this.neighborsOf=function(a,b,c){if("number"!=typeof a&&"string"!=typeof a)throw new TypeError("Invalid argument: id is not a string or a number, was "+a);if("string"==typeof a&&!a.length)throw new TypeError("Invalid argument: id is an empty string.");return register("neighbors",a,b,c),this},this.apply=function(){for(var a=0,b=_chain.length;b>a;++a)switch(_chain[a].processor){case"nodes":Processors.nodes(_g,_chain[a].predicate,_chain[a].options);break;case"edges":Processors.edges(_g,_chain[a].predicate,_chain[a].options);break;case"neighbors":Processors.neighbors(_g,_chain[a].predicate);break;case"undo":Processors.undo(_g,_chain[a].predicate);break;default:throw new Error("Unknown processor "+_chain[a].processor)}return _chain[0]&&"undo"===_chain[0].key&&_chain.shift(),_s&&_s.refresh(),this},this.undo=function(a){var b=Object.create(null),c=arguments.length;if(1===c)if("[object Array]"===Object.prototype.toString.call(a))for(var d=0,e=a.length;e>d;d++)b[a[d]]=!0;else b[a]=!0;else if(c>1)for(var d=0;c>d;d++)b[arguments[d]]=!0;else this.clear();return unregister(b),_chain.unshift({key:"undo",processor:"undo"}),this},this.clear=function(){return _chain.length=0,_keysIndex=Object.create(null),this},this.kill=function(){return this.clear(),delete _instance[_s.id],_g=null,_s=null,this},this.serialize=function(){for(var a=cloneChain(_chain),b=0,c=a.length;c>b;b++)a[b].predicate=a[b].predicate.toString().replace(/\s+/g," ").replace(/"use strict"; /,"");return a},this.load=function(chain){if(chain===undefined)throw new TypeError("Missing argument.");if(!Array.isArray(chain))throw new TypeError('Invalid argument: "chain" is not an array, was '+chain);this.clear();for(var copy=cloneChain(chain),i=0,len=copy.length;len>i;i++){if(copy[i].predicate===undefined)throw new TypeError('Missing filter key: "predicate".');if(copy[i].processor===undefined)throw new TypeError('Missing filter key: "processor".');if(copy[i].key!=undefined&&"string"!=typeof copy[i].key)throw new TypeError('Invalid filter key: "key" is not a string, was '+copy[i].key.toString());if("string"==typeof copy[i].predicate&&eval(" copy[i].predicate = "+copy[i].predicate),"function"!=typeof copy[i].predicate)throw new TypeError('Invalid filter key: "predicate" of key "'+copy[i].key+'" is not a function.');if("string"!=typeof copy[i].processor)throw new TypeError('Invalid filter key: "processor" of key "'+copy[i].key+'" is not a string.');copy[i].key&&(_keysIndex[copy[i].key]=!0)}return _chain=copy,this}}if("undefined"==typeof sigma)throw new Error("sigma is not declared");sigma.utils.pkg("sigma.plugins");var _instance={};sigma.classes.graph.hasMethod("adjacentNodes")||sigma.classes.graph.addMethod("adjacentNodes",function(a){if("number"!=typeof a&&"string"!=typeof a)throw new TypeError('Invalid argument: "id" is not a string or a number, was '+a);var b,c=[];for(b in this.allNeighborsIndex[a])c.push(this.nodesIndex.get(b));return c}),sigma.classes.graph.hasMethod("adjacentEdges")||sigma.classes.graph.addMethod("adjacentEdges",function(a){if("number"!=typeof a&&"string"!=typeof a)throw new TypeError('Invalid argument: "id" is not a string or a number, was '+a);var b,c,d=this.allNeighborsIndex[a],e=[];for(c in d)for(b in d[c])e.push(d[c][b]);return e});var Processors={};Processors.nodes=function(a,b,c){if(a){for(var d=a.nodes(),e=d.length,f=a.edges(),g=f.length;e--;)d[e].hidden=!b.call({graph:a,get:strToObjectRef},d[e],c)||d[e].hidden;for(;g--;)(a.nodes(f[g].source).hidden||a.nodes(f[g].target).hidden)&&(f[g].hidden=!0)}},Processors.edges=function(a,b,c){if(a)for(var d=a.edges(),e=d.length;e--;)d[e].hidden=!b.call({graph:a,get:strToObjectRef},d[e],c)||d[e].hidden},Processors.neighbors=function(a,b){if(a){for(var c=a.nodes(),d=c.length,e=a.edges(),f=e.length,g=a.adjacentNodes(b),h=g.length,i={};h--;)i[g[h].id]=!0;for(;d--;)c[d].id===b||c[d].id in i||(c[d].hidden=!0);for(;f--;)(a.nodes(e[f].source).hidden||a.nodes(e[f].target).hidden)&&(e[f].hidden=!0)}},Processors.undo=function(a){if(a){for(var b=a.nodes(),c=b.length,d=a.edges(),e=d.length;c--;)b[c].hidden=!1;for(;e--;)d[e].hidden=!1}},sigma.plugins.filter=function(a){return _instance[a.id]||(_instance[a.id]=new Filter(a),a.bind("kill",function(){sigma.plugins.killFilter(a)})),_instance[a.id]},sigma.plugins.killFilter=function(a){_instance[a.id]instanceof Filter&&_instance[a.id].kill(),delete _instance[a.id]}}).call(this);
//# sourceMappingURL=sigma.plugins.filter.min.js.map